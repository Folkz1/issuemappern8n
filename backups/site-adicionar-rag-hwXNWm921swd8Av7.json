{"updatedAt":"2026-01-13T20:07:39.665Z","createdAt":"2026-01-07T18:01:36.987Z","id":"hwXNWm921swd8Av7","name":"site adicionar rag","active":true,"isArchived":false,"nodes":[{"parameters":{"path":"knowledge-base-manager","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-48,-144],"id":"38432b52-e756-42a4-b8a2-e8092e5d5360","name":"Webhook","webhookId":"e7eca8fb-8493-4036-8e59-3d98ca577771"},{"parameters":{"respondWith":"text","responseBody":"<!DOCTYPE html>\n<html lang=\"pt-br\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Superbot | RAG Manager</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap\" rel=\"stylesheet\">\n    <style>\n        :root {\n            --bg: #0a0a0c;\n            --card-bg: rgba(255, 255, 255, 0.05);\n            --border: rgba(255, 255, 255, 0.1);\n            --accent: #00f2ff;\n            --text-main: #e0e0e0;\n            --text-dim: #a0a0a0;\n            --danger: #ff4d4d;\n            --success: #00ff88;\n        }\n\n        * {\n            box-sizing: border-box;\n        }\n\n        body {\n            background: var(--bg);\n            color: var(--text-main);\n            font-family: 'Inter', sans-serif;\n            margin: 0;\n            padding: 40px;\n            display: flex;\n            justify-content: center;\n        }\n\n        .container {\n            width: 100%;\n            max-width: 900px;\n        }\n\n        header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-end;\n            border-bottom: 1px solid var(--border);\n            padding-bottom: 20px;\n            margin-bottom: 40px;\n        }\n\n        h1 {\n            font-weight: 600;\n            font-size: 2.2rem;\n            margin: 0;\n            color: #fff;\n        }\n\n        p.subtitle {\n            color: var(--text-dim);\n            margin-top: 8px;\n            font-size: 1rem;\n        }\n\n        .glass-card {\n            background: var(--card-bg);\n            border: 1px solid var(--border);\n            backdrop-filter: blur(20px);\n            border-radius: 20px;\n            padding: 32px;\n            margin-bottom: 30px;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        }\n\n        .info-banner {\n            background: rgba(0, 242, 255, 0.1);\n            border: 1px solid rgba(0, 242, 255, 0.3);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 20px;\n            font-size: 0.9rem;\n            line-height: 1.5;\n        }\n\n        .info-banner strong {\n            color: var(--accent);\n        }\n\n        /* Form section */\n        .input-group {\n            margin-bottom: 20px;\n        }\n\n        label {\n            display: block;\n            font-size: 0.75rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n            color: var(--accent);\n            letter-spacing: 1px;\n        }\n\n        input[type=\"text\"],\n        textarea,\n        select {\n            width: 100%;\n            background: rgba(0, 0, 0, 0.4);\n            border: 1px solid var(--border);\n            border-radius: 12px;\n            padding: 16px;\n            color: white;\n            font-family: inherit;\n            font-size: 1rem;\n            outline: none;\n            transition: 0.3s;\n        }\n\n        select option {\n            background: var(--bg);\n        }\n\n        textarea:focus,\n        select:focus,\n        input:focus {\n            border-color: var(--accent);\n            box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);\n        }\n\n        .btn-primary {\n            background: var(--accent);\n            color: #000;\n            border: none;\n            padding: 14px 28px;\n            border-radius: 10px;\n            font-weight: 600;\n            font-size: 1rem;\n            cursor: pointer;\n            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            width: 100%;\n        }\n\n        .btn-primary:hover {\n            transform: scale(1.02);\n            filter: brightness(1.1);\n            box-shadow: 0 5px 20px rgba(0, 242, 255, 0.3);\n        }\n\n        .btn-primary:disabled {\n            opacity: 0.6;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        /* List Section */\n        .doc-list-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .doc-stats {\n            font-size: 0.85rem;\n            color: var(--text-dim);\n        }\n\n        .doc-stats span {\n            color: var(--accent);\n            font-weight: 600;\n        }\n\n        .doc-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            padding: 20px;\n            border-bottom: 1px solid var(--border);\n            transition: 0.2s;\n        }\n\n        .doc-item:hover {\n            background: rgba(255, 255, 255, 0.02);\n        }\n\n        .doc-item:last-child {\n            border-bottom: none;\n        }\n\n        .doc-content-text {\n            font-size: 0.9rem;\n            line-height: 1.5;\n            color: #ddd;\n            margin-bottom: 8px;\n            max-height: 100px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n        }\n\n        .doc-meta {\n            font-size: 0.75rem;\n            color: var(--text-dim);\n            display: flex;\n            gap: 16px;\n            flex-wrap: wrap;\n        }\n\n        .chunk-badge {\n            background: rgba(0, 242, 255, 0.15);\n            color: var(--accent);\n            padding: 2px 8px;\n            border-radius: 4px;\n            font-size: 0.7rem;\n            font-weight: 600;\n        }\n\n        .btn-refresh {\n            background: transparent;\n            border: 1px solid var(--accent);\n            color: var(--accent);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 0.8rem;\n            transition: 0.2s;\n        }\n\n        .btn-refresh:hover {\n            background: rgba(0, 242, 255, 0.1);\n        }\n\n        .btn-delete {\n            background: rgba(255, 77, 77, 0.1);\n            color: var(--danger);\n            border: 1px solid rgba(255, 77, 77, 0.2);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: 0.2s;\n            white-space: nowrap;\n        }\n\n        .btn-delete:hover {\n            background: var(--danger);\n            color: white;\n        }\n\n        .btn-delete-all {\n            background: rgba(255, 77, 77, 0.1);\n            color: var(--danger);\n            border: 1px solid rgba(255, 77, 77, 0.2);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: 0.2s;\n            margin-left: 8px;\n        }\n\n        .btn-delete-all:hover {\n            background: var(--danger);\n            color: white;\n        }\n\n        .tag {\n            color: var(--accent);\n            margin-right: 12px;\n            font-weight: 600;\n        }\n\n        .success-msg {\n            color: var(--success);\n            font-size: 0.9rem;\n            margin-top: 12px;\n            display: none;\n        }\n    </style>\n</head>\n\n<body>\n\n    <div class=\"container\">\n        <header>\n            <div>\n                <h1>Knowledge Base</h1>\n                <p class=\"subtitle\">Gerencie o conhecimento de suas IAs por projeto.</p>\n            </div>\n            <div style=\"width: 300px;\">\n                <label>SELECIONE O PROJETO</label>\n                <select id=\"projectSelect\" onchange=\"onProjectChange()\">\n                    <option value=\"\">Carregando projetos...</option>\n                </select>\n            </div>\n        </header>\n\n        <!-- Ingest Form -->\n        <div class=\"glass-card\">\n            <div class=\"info-banner\">\n                <strong>✨ Chunking Automático:</strong> Textos grandes são automaticamente divididos em partes menores (~800 caracteres) para melhorar a precisão das buscas. Cada parte mantém contexto com sobreposição de 100 caracteres.\n            </div>\n            <div class=\"input-group\">\n                <label>NOVO CONHECIMENTO</label>\n                <input type=\"text\" id=\"docTitle\" placeholder=\"Título (ex: Horário de Funcionamento)\"\n                    style=\"margin-bottom: 10px;\">\n                <textarea id=\"docContent\" rows=\"8\"\n                    placeholder=\"Digite aqui informações sobre a clínica, preços, horários ou tratamentos...&#10;&#10;Dica: Use formatação Markdown (## para títulos, - para listas) para melhor organização dos chunks.\"></textarea>\n            </div>\n            <button class=\"btn-primary\" onclick=\"addDocument()\" id=\"btnAdd\">Salvar na Memória</button>\n            <p class=\"success-msg\" id=\"successMsg\"></p>\n        </div>\n\n        <!-- Storage List -->\n        <div class=\"glass-card\">\n            <div class=\"doc-list-header\">\n                <div>\n                    <h2 style=\"font-size: 1.25rem; margin: 0;\">Memória Sincronizada</h2>\n                    <p class=\"doc-stats\" id=\"docStats\"></p>\n                </div>\n                <div>\n                    <button class=\"btn-refresh\" onclick=\"fetchDocs()\">Atualizar Lista</button>\n                    <button class=\"btn-delete-all\" onclick=\"deleteAllDocs()\" id=\"btnDeleteAll\" style=\"display: none;\">Limpar Tudo</button>\n                </div>\n            </div>\n            <div id=\"docsList\">\n                <p style=\"text-align: center; color: var(--text-dim); padding: 20px;\">Selecione um projeto para ver a\n                    memória.</p>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        const INGEST_URL = \"https://ai.superbot.digital/webhook/rag-ingest\";\n        const MANAGER_URL = \"https://ai.superbot.digital/webhook/rag-manager\";\n\n        let currentProjectId = \"\";\n\n        async function loadProjects() {\n            try {\n                const response = await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'get_projects' })\n                });\n                const result = await response.json();\n\n                let projects = [];\n                if (Array.isArray(result) && result[0] && result[0].data) {\n                    projects = result[0].data;\n                } else if (result.data) {\n                    projects = result.data;\n                } else if (Array.isArray(result)) {\n                    projects = result;\n                }\n\n                const select = document.getElementById('projectSelect');\n                select.innerHTML = projects.map(p => `<option value=\"${p.id}\">${p.company_name} (${p.project_slug})</option>`).join('');\n\n                const dentaly = projects.find(p => p.project_slug === 'dentaly');\n                if (dentaly) select.value = dentaly.id;\n\n                onProjectChange();\n            } catch (e) {\n                console.error(e);\n                alert(\"Erro ao carregar projetos. Verifique o console.\");\n            }\n        }\n\n        function onProjectChange() {\n            currentProjectId = document.getElementById('projectSelect').value;\n            if (currentProjectId) fetchDocs();\n        }\n\n        async function fetchDocs() {\n            const container = document.getElementById('docsList');\n            const statsEl = document.getElementById('docStats');\n            const btnDeleteAll = document.getElementById('btnDeleteAll');\n            \n            if (!currentProjectId) return;\n\n            container.innerHTML = \"<p style='text-align: center; color: var(--text-dim); padding: 20px;'>Carregando...</p>\";\n\n            try {\n                const response = await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'list', project_id: currentProjectId })\n                });\n                const result = await response.json();\n\n                let docs = [];\n                if (Array.isArray(result) && result[0] && result[0].data) {\n                    docs = result[0].data;\n                } else if (result.data) {\n                    docs = result.data;\n                } else if (Array.isArray(result)) {\n                    docs = result;\n                }\n\n                // Calcular estatísticas\n                const uniqueTitles = new Set(docs.map(d => d.metadata?.title || 'Sem Título'));\n                statsEl.innerHTML = `<span>${docs.length}</span> chunks de <span>${uniqueTitles.size}</span> documentos`;\n                \n                btnDeleteAll.style.display = docs.length > 0 ? 'inline-block' : 'none';\n\n                renderDocs(docs);\n            } catch (e) {\n                console.error(e);\n                container.innerHTML = `<p style=\"color: #ff4d4d; text-align: center;\">Erro de conexão com a API.</p>`;\n            }\n        }\n\n        function renderDocs(docs) {\n            const container = document.getElementById('docsList');\n            if (!docs || docs.length === 0) {\n                container.innerHTML = \"<p style='text-align: center; color: var(--text-dim); padding: 20px;'>A base de conhecimento deste projeto está vazia.</p>\";\n                return;\n            }\n            \n            container.innerHTML = docs.map(doc => {\n                const chunkInfo = doc.metadata?.chunk_index !== undefined \n                    ? `<span class=\"chunk-badge\">Chunk ${doc.metadata.chunk_index + 1}/${doc.metadata.total_chunks}</span>` \n                    : '';\n                const contentPreview = doc.content.length > 300 \n                    ? doc.content.substring(0, 300) + '...' \n                    : doc.content;\n                    \n                return `\n                <div class=\"doc-item\">\n                    <div style=\"flex: 1; padding-right: 20px;\">\n                        <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 4px;\">\n                            <strong style=\"color: var(--accent); font-size: 1rem;\">${doc.metadata?.title || 'Sem Título'}</strong>\n                            ${chunkInfo}\n                        </div>\n                        <div class=\"doc-content-text\">${contentPreview}</div>\n                        <div class=\"doc-meta\">\n                            <span>${new Date(doc.created_at).toLocaleString()}</span>\n                            <span>${doc.content.length} caracteres</span>\n                        </div>\n                    </div>\n                    <button class=\"btn-delete\" onclick=\"deleteDoc('${doc.id}')\">Remover</button>\n                </div>\n            `}).join('');\n        }\n\n        async function addDocument() {\n            const title = document.getElementById('docTitle').value;\n            const content = document.getElementById('docContent').value;\n            const btn = document.getElementById('btnAdd');\n            const successMsg = document.getElementById('successMsg');\n            \n            if (!content || !currentProjectId) return alert(\"Preencha o conteúdo\");\n\n            btn.innerText = \"Processando...\";\n            btn.disabled = true;\n            successMsg.style.display = 'none';\n\n            try {\n                const res = await fetch(INGEST_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        project_id: currentProjectId,\n                        content: content,\n                        metadata: {\n                            title: title || \"Sem Título\",\n                            source: \"MANAGER_UI\"\n                        }\n                    })\n                });\n                \n                if (res.ok) {\n                    const result = await res.json();\n                    const chunksCreated = result.chunks_created || 1;\n                    \n                    document.getElementById('docContent').value = '';\n                    document.getElementById('docTitle').value = '';\n                    \n                    successMsg.innerText = `✓ Documento salvo com sucesso! ${chunksCreated} chunk(s) criado(s).`;\n                    successMsg.style.display = 'block';\n                    \n                    setTimeout(() => {\n                        successMsg.style.display = 'none';\n                    }, 5000);\n                    \n                    fetchDocs();\n                } else {\n                    throw new Error('Erro na resposta');\n                }\n            } catch (e) {\n                console.error(e);\n                alert(\"Erro ao salvar. Verifique o console.\");\n            } finally {\n                btn.innerText = \"Salvar na Memória\";\n                btn.disabled = false;\n            }\n        }\n\n        async function deleteDoc(id) {\n            if (!confirm(\"Deseja deletar este chunk permanentemente?\")) return;\n\n            try {\n                await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'delete', id: id, project_id: currentProjectId })\n                });\n                fetchDocs();\n            } catch (e) {\n                alert(\"Erro ao deletar.\");\n            }\n        }\n\n        async function deleteAllDocs() {\n            if (!confirm(\"⚠️ ATENÇÃO: Isso irá deletar TODOS os documentos deste projeto. Tem certeza?\")) return;\n            if (!confirm(\"Esta ação é IRREVERSÍVEL. Confirma a exclusão de todos os documentos?\")) return;\n\n            try {\n                await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'delete_all', project_id: currentProjectId })\n                });\n                fetchDocs();\n            } catch (e) {\n                alert(\"Erro ao deletar.\");\n            }\n        }\n\n        // Initial Load\n        loadProjects();\n    </script>\n\n</body>\n\n</html>\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[192,-144],"id":"21e053c6-ce14-4935-914c-a6ed84a61a20","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6c9d89c8-2c6d-4b4c-8d27-999b083b6a0a","activeVersionId":"6c9d89c8-2c6d-4b4c-8d27-999b083b6a0a","triggerCount":1,"shared":[{"updatedAt":"2026-01-07T18:01:36.987Z","createdAt":"2026-01-07T18:01:36.987Z","role":"workflow:owner","workflowId":"hwXNWm921swd8Av7","projectId":"zyT6Lzq0Jawtq8wZ"}],"activeVersion":{"updatedAt":"2026-01-13T20:07:39.644Z","createdAt":"2026-01-13T20:07:39.644Z","versionId":"6c9d89c8-2c6d-4b4c-8d27-999b083b6a0a","workflowId":"hwXNWm921swd8Av7","nodes":[{"parameters":{"path":"knowledge-base-manager","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-48,-144],"id":"38432b52-e756-42a4-b8a2-e8092e5d5360","name":"Webhook","webhookId":"e7eca8fb-8493-4036-8e59-3d98ca577771"},{"parameters":{"respondWith":"text","responseBody":"<!DOCTYPE html>\n<html lang=\"pt-br\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Superbot | RAG Manager</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap\" rel=\"stylesheet\">\n    <style>\n        :root {\n            --bg: #0a0a0c;\n            --card-bg: rgba(255, 255, 255, 0.05);\n            --border: rgba(255, 255, 255, 0.1);\n            --accent: #00f2ff;\n            --text-main: #e0e0e0;\n            --text-dim: #a0a0a0;\n            --danger: #ff4d4d;\n            --success: #00ff88;\n        }\n\n        * {\n            box-sizing: border-box;\n        }\n\n        body {\n            background: var(--bg);\n            color: var(--text-main);\n            font-family: 'Inter', sans-serif;\n            margin: 0;\n            padding: 40px;\n            display: flex;\n            justify-content: center;\n        }\n\n        .container {\n            width: 100%;\n            max-width: 900px;\n        }\n\n        header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-end;\n            border-bottom: 1px solid var(--border);\n            padding-bottom: 20px;\n            margin-bottom: 40px;\n        }\n\n        h1 {\n            font-weight: 600;\n            font-size: 2.2rem;\n            margin: 0;\n            color: #fff;\n        }\n\n        p.subtitle {\n            color: var(--text-dim);\n            margin-top: 8px;\n            font-size: 1rem;\n        }\n\n        .glass-card {\n            background: var(--card-bg);\n            border: 1px solid var(--border);\n            backdrop-filter: blur(20px);\n            border-radius: 20px;\n            padding: 32px;\n            margin-bottom: 30px;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        }\n\n        .info-banner {\n            background: rgba(0, 242, 255, 0.1);\n            border: 1px solid rgba(0, 242, 255, 0.3);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 20px;\n            font-size: 0.9rem;\n            line-height: 1.5;\n        }\n\n        .info-banner strong {\n            color: var(--accent);\n        }\n\n        /* Form section */\n        .input-group {\n            margin-bottom: 20px;\n        }\n\n        label {\n            display: block;\n            font-size: 0.75rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n            color: var(--accent);\n            letter-spacing: 1px;\n        }\n\n        input[type=\"text\"],\n        textarea,\n        select {\n            width: 100%;\n            background: rgba(0, 0, 0, 0.4);\n            border: 1px solid var(--border);\n            border-radius: 12px;\n            padding: 16px;\n            color: white;\n            font-family: inherit;\n            font-size: 1rem;\n            outline: none;\n            transition: 0.3s;\n        }\n\n        select option {\n            background: var(--bg);\n        }\n\n        textarea:focus,\n        select:focus,\n        input:focus {\n            border-color: var(--accent);\n            box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);\n        }\n\n        .btn-primary {\n            background: var(--accent);\n            color: #000;\n            border: none;\n            padding: 14px 28px;\n            border-radius: 10px;\n            font-weight: 600;\n            font-size: 1rem;\n            cursor: pointer;\n            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            width: 100%;\n        }\n\n        .btn-primary:hover {\n            transform: scale(1.02);\n            filter: brightness(1.1);\n            box-shadow: 0 5px 20px rgba(0, 242, 255, 0.3);\n        }\n\n        .btn-primary:disabled {\n            opacity: 0.6;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        /* List Section */\n        .doc-list-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .doc-stats {\n            font-size: 0.85rem;\n            color: var(--text-dim);\n        }\n\n        .doc-stats span {\n            color: var(--accent);\n            font-weight: 600;\n        }\n\n        .doc-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            padding: 20px;\n            border-bottom: 1px solid var(--border);\n            transition: 0.2s;\n        }\n\n        .doc-item:hover {\n            background: rgba(255, 255, 255, 0.02);\n        }\n\n        .doc-item:last-child {\n            border-bottom: none;\n        }\n\n        .doc-content-text {\n            font-size: 0.9rem;\n            line-height: 1.5;\n            color: #ddd;\n            margin-bottom: 8px;\n            max-height: 100px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n        }\n\n        .doc-meta {\n            font-size: 0.75rem;\n            color: var(--text-dim);\n            display: flex;\n            gap: 16px;\n            flex-wrap: wrap;\n        }\n\n        .chunk-badge {\n            background: rgba(0, 242, 255, 0.15);\n            color: var(--accent);\n            padding: 2px 8px;\n            border-radius: 4px;\n            font-size: 0.7rem;\n            font-weight: 600;\n        }\n\n        .btn-refresh {\n            background: transparent;\n            border: 1px solid var(--accent);\n            color: var(--accent);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 0.8rem;\n            transition: 0.2s;\n        }\n\n        .btn-refresh:hover {\n            background: rgba(0, 242, 255, 0.1);\n        }\n\n        .btn-delete {\n            background: rgba(255, 77, 77, 0.1);\n            color: var(--danger);\n            border: 1px solid rgba(255, 77, 77, 0.2);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: 0.2s;\n            white-space: nowrap;\n        }\n\n        .btn-delete:hover {\n            background: var(--danger);\n            color: white;\n        }\n\n        .btn-delete-all {\n            background: rgba(255, 77, 77, 0.1);\n            color: var(--danger);\n            border: 1px solid rgba(255, 77, 77, 0.2);\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: 0.2s;\n            margin-left: 8px;\n        }\n\n        .btn-delete-all:hover {\n            background: var(--danger);\n            color: white;\n        }\n\n        .tag {\n            color: var(--accent);\n            margin-right: 12px;\n            font-weight: 600;\n        }\n\n        .success-msg {\n            color: var(--success);\n            font-size: 0.9rem;\n            margin-top: 12px;\n            display: none;\n        }\n    </style>\n</head>\n\n<body>\n\n    <div class=\"container\">\n        <header>\n            <div>\n                <h1>Knowledge Base</h1>\n                <p class=\"subtitle\">Gerencie o conhecimento de suas IAs por projeto.</p>\n            </div>\n            <div style=\"width: 300px;\">\n                <label>SELECIONE O PROJETO</label>\n                <select id=\"projectSelect\" onchange=\"onProjectChange()\">\n                    <option value=\"\">Carregando projetos...</option>\n                </select>\n            </div>\n        </header>\n\n        <!-- Ingest Form -->\n        <div class=\"glass-card\">\n            <div class=\"info-banner\">\n                <strong>✨ Chunking Automático:</strong> Textos grandes são automaticamente divididos em partes menores (~800 caracteres) para melhorar a precisão das buscas. Cada parte mantém contexto com sobreposição de 100 caracteres.\n            </div>\n            <div class=\"input-group\">\n                <label>NOVO CONHECIMENTO</label>\n                <input type=\"text\" id=\"docTitle\" placeholder=\"Título (ex: Horário de Funcionamento)\"\n                    style=\"margin-bottom: 10px;\">\n                <textarea id=\"docContent\" rows=\"8\"\n                    placeholder=\"Digite aqui informações sobre a clínica, preços, horários ou tratamentos...&#10;&#10;Dica: Use formatação Markdown (## para títulos, - para listas) para melhor organização dos chunks.\"></textarea>\n            </div>\n            <button class=\"btn-primary\" onclick=\"addDocument()\" id=\"btnAdd\">Salvar na Memória</button>\n            <p class=\"success-msg\" id=\"successMsg\"></p>\n        </div>\n\n        <!-- Storage List -->\n        <div class=\"glass-card\">\n            <div class=\"doc-list-header\">\n                <div>\n                    <h2 style=\"font-size: 1.25rem; margin: 0;\">Memória Sincronizada</h2>\n                    <p class=\"doc-stats\" id=\"docStats\"></p>\n                </div>\n                <div>\n                    <button class=\"btn-refresh\" onclick=\"fetchDocs()\">Atualizar Lista</button>\n                    <button class=\"btn-delete-all\" onclick=\"deleteAllDocs()\" id=\"btnDeleteAll\" style=\"display: none;\">Limpar Tudo</button>\n                </div>\n            </div>\n            <div id=\"docsList\">\n                <p style=\"text-align: center; color: var(--text-dim); padding: 20px;\">Selecione um projeto para ver a\n                    memória.</p>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        const INGEST_URL = \"https://ai.superbot.digital/webhook/rag-ingest\";\n        const MANAGER_URL = \"https://ai.superbot.digital/webhook/rag-manager\";\n\n        let currentProjectId = \"\";\n\n        async function loadProjects() {\n            try {\n                const response = await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'get_projects' })\n                });\n                const result = await response.json();\n\n                let projects = [];\n                if (Array.isArray(result) && result[0] && result[0].data) {\n                    projects = result[0].data;\n                } else if (result.data) {\n                    projects = result.data;\n                } else if (Array.isArray(result)) {\n                    projects = result;\n                }\n\n                const select = document.getElementById('projectSelect');\n                select.innerHTML = projects.map(p => `<option value=\"${p.id}\">${p.company_name} (${p.project_slug})</option>`).join('');\n\n                const dentaly = projects.find(p => p.project_slug === 'dentaly');\n                if (dentaly) select.value = dentaly.id;\n\n                onProjectChange();\n            } catch (e) {\n                console.error(e);\n                alert(\"Erro ao carregar projetos. Verifique o console.\");\n            }\n        }\n\n        function onProjectChange() {\n            currentProjectId = document.getElementById('projectSelect').value;\n            if (currentProjectId) fetchDocs();\n        }\n\n        async function fetchDocs() {\n            const container = document.getElementById('docsList');\n            const statsEl = document.getElementById('docStats');\n            const btnDeleteAll = document.getElementById('btnDeleteAll');\n            \n            if (!currentProjectId) return;\n\n            container.innerHTML = \"<p style='text-align: center; color: var(--text-dim); padding: 20px;'>Carregando...</p>\";\n\n            try {\n                const response = await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'list', project_id: currentProjectId })\n                });\n                const result = await response.json();\n\n                let docs = [];\n                if (Array.isArray(result) && result[0] && result[0].data) {\n                    docs = result[0].data;\n                } else if (result.data) {\n                    docs = result.data;\n                } else if (Array.isArray(result)) {\n                    docs = result;\n                }\n\n                // Calcular estatísticas\n                const uniqueTitles = new Set(docs.map(d => d.metadata?.title || 'Sem Título'));\n                statsEl.innerHTML = `<span>${docs.length}</span> chunks de <span>${uniqueTitles.size}</span> documentos`;\n                \n                btnDeleteAll.style.display = docs.length > 0 ? 'inline-block' : 'none';\n\n                renderDocs(docs);\n            } catch (e) {\n                console.error(e);\n                container.innerHTML = `<p style=\"color: #ff4d4d; text-align: center;\">Erro de conexão com a API.</p>`;\n            }\n        }\n\n        function renderDocs(docs) {\n            const container = document.getElementById('docsList');\n            if (!docs || docs.length === 0) {\n                container.innerHTML = \"<p style='text-align: center; color: var(--text-dim); padding: 20px;'>A base de conhecimento deste projeto está vazia.</p>\";\n                return;\n            }\n            \n            container.innerHTML = docs.map(doc => {\n                const chunkInfo = doc.metadata?.chunk_index !== undefined \n                    ? `<span class=\"chunk-badge\">Chunk ${doc.metadata.chunk_index + 1}/${doc.metadata.total_chunks}</span>` \n                    : '';\n                const contentPreview = doc.content.length > 300 \n                    ? doc.content.substring(0, 300) + '...' \n                    : doc.content;\n                    \n                return `\n                <div class=\"doc-item\">\n                    <div style=\"flex: 1; padding-right: 20px;\">\n                        <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 4px;\">\n                            <strong style=\"color: var(--accent); font-size: 1rem;\">${doc.metadata?.title || 'Sem Título'}</strong>\n                            ${chunkInfo}\n                        </div>\n                        <div class=\"doc-content-text\">${contentPreview}</div>\n                        <div class=\"doc-meta\">\n                            <span>${new Date(doc.created_at).toLocaleString()}</span>\n                            <span>${doc.content.length} caracteres</span>\n                        </div>\n                    </div>\n                    <button class=\"btn-delete\" onclick=\"deleteDoc('${doc.id}')\">Remover</button>\n                </div>\n            `}).join('');\n        }\n\n        async function addDocument() {\n            const title = document.getElementById('docTitle').value;\n            const content = document.getElementById('docContent').value;\n            const btn = document.getElementById('btnAdd');\n            const successMsg = document.getElementById('successMsg');\n            \n            if (!content || !currentProjectId) return alert(\"Preencha o conteúdo\");\n\n            btn.innerText = \"Processando...\";\n            btn.disabled = true;\n            successMsg.style.display = 'none';\n\n            try {\n                const res = await fetch(INGEST_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        project_id: currentProjectId,\n                        content: content,\n                        metadata: {\n                            title: title || \"Sem Título\",\n                            source: \"MANAGER_UI\"\n                        }\n                    })\n                });\n                \n                if (res.ok) {\n                    const result = await res.json();\n                    const chunksCreated = result.chunks_created || 1;\n                    \n                    document.getElementById('docContent').value = '';\n                    document.getElementById('docTitle').value = '';\n                    \n                    successMsg.innerText = `✓ Documento salvo com sucesso! ${chunksCreated} chunk(s) criado(s).`;\n                    successMsg.style.display = 'block';\n                    \n                    setTimeout(() => {\n                        successMsg.style.display = 'none';\n                    }, 5000);\n                    \n                    fetchDocs();\n                } else {\n                    throw new Error('Erro na resposta');\n                }\n            } catch (e) {\n                console.error(e);\n                alert(\"Erro ao salvar. Verifique o console.\");\n            } finally {\n                btn.innerText = \"Salvar na Memória\";\n                btn.disabled = false;\n            }\n        }\n\n        async function deleteDoc(id) {\n            if (!confirm(\"Deseja deletar este chunk permanentemente?\")) return;\n\n            try {\n                await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'delete', id: id, project_id: currentProjectId })\n                });\n                fetchDocs();\n            } catch (e) {\n                alert(\"Erro ao deletar.\");\n            }\n        }\n\n        async function deleteAllDocs() {\n            if (!confirm(\"⚠️ ATENÇÃO: Isso irá deletar TODOS os documentos deste projeto. Tem certeza?\")) return;\n            if (!confirm(\"Esta ação é IRREVERSÍVEL. Confirma a exclusão de todos os documentos?\")) return;\n\n            try {\n                await fetch(MANAGER_URL, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ action: 'delete_all', project_id: currentProjectId })\n                });\n                fetchDocs();\n            } catch (e) {\n                alert(\"Erro ao deletar.\");\n            }\n        }\n\n        // Initial Load\n        loadProjects();\n    </script>\n\n</body>\n\n</html>\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[192,-144],"id":"21e053c6-ce14-4935-914c-a6ed84a61a20","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"authors":"Emilio Ricci","name":null,"description":null},"tags":[]}