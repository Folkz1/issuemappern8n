{"updatedAt":"2026-01-02T17:21:46.808Z","createdAt":"2025-12-02T17:57:19.537Z","id":"6r96toM7R8JXf51A","name":"Relatoriorio de Intera√ß√µes- E-MAIL com √Åudio","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"bc26c6f0-d7d0-4734-a9ff-463b76867a9b","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1264,16],"id":"13e65982-5f3c-4dc9-8793-dfaa8cb48e06","name":"Webhook","webhookId":"bc26c6f0-d7d0-4734-a9ff-463b76867a9b"},{"parameters":{"assignments":{"assignments":[{"id":"conversation_id","name":"conversation_id","value":"={{ $json.body.data.conversation_id }}","type":"string"},{"id":"name","name":"name","value":"={{ $json.body.data.analysis.data_collection_results.name.value || 'N√É¬£o fornecido' }}","type":"string"},{"id":"TELEFONE_number","name":"TELEFONE_number","value":"={{ $json.body.data.analysis.data_collection_results.TELEFONE_number.value || $json.body.data.metadata.TELEFONE_call?.external_number || 'N√É¬£o fornecido' }}","type":"string"},{"id":"E-MAIL","name":"E-MAIL","value":"={{ $json.body.data.analysis.data_collection_results.E-MAIL.value || 'N√É¬£o fornecido' }}","type":"string"},{"id":"call_DURA√á√ÉO","name":"call_DURA√á√ÉO","value":"={{ $json.body.data.metadata.call_DURA√á√ÉO_secs }}","type":"number"},{"id":"cost","name":"cost","value":"=","type":"number"},{"id":"start_time","name":"start_time","value":"={{ $json.body.data.metadata.start_time_unix_secs }}","type":"number"},{"id":"TELEFONE_call","name":"TELEFONE_call","value":"={{ $json.body.data.metadata.TELEFONE_call }}","type":"object"},{"id":"Resumo","name":"Resumo","value":"={{ $json.body.data.analysis.transcript_Resumo }}","type":"string"},{"id":"title","name":"title","value":"={{ $json.body.data.analysis.call_Resumo_title }}","type":"string"},{"id":"call_Sucessoful","name":"call_Sucessoful","value":"={{ $json.body.data.analysis.call_Sucessoful }}","type":"string"},{"id":"transcript","name":"transcript","value":"={{ $json.body.data.transcript }}","type":"array"},{"id":"data_collection","name":"data_collection","value":"={{ $json.body.data.analysis.data_collection_results }}","type":"object"},{"id":"termination_reason","name":"termination_reason","value":"={{ $json.body.data.metadata.termination_reason }}","type":"string"}]},"options":{}},"id":"def21178-3984-4bc6-a378-2ec792a81c6d","name":"Extrair Dados","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[-1040,16]},{"parameters":{"jsCode":"// Code for the n8n \"Generate HTML\" node - Unified Version (Web + Phone)\n// Copy and paste this code into the workflow's Code node\n\n// 1. GET DATA FROM PREVIOUS NODES\n// Extraction and Upload node data (kept from original logic)\nconst extractDataNode = $('Extrair Dados').first().json;\nconst audioUploadNode = $('Upload upload/audio').first().json;\n\n// STATISTICS DATA (This is the main change)\n// We explicitly get data from both HTTP Request nodes\nconst webStatsData = $('Buscar Estat√°sticas do M√™s web').first().json;\nconst phoneStatsData = $input.first().json;\n\n// Use extracted data as the main source for this call details\nconst audioUploadResponse = audioUploadNode;\n\n// Helper formatting functions\nfunction formatDuration(seconds) {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n}\n\nfunction formatDate(unixTimestamp) {\n    const date = new Date(unixTimestamp * 1000);\n    return date.toLocaleString('pt-BR', {\n        timeZone: 'America/Sao_Paulo',\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: false\n    });\n}\n\nfunction formatMinutes(seconds) {\n    const mins = Math.floor(seconds / 60);\n    return `${mins} min`;\n}\n\n// Helper function to handle undefined/null values\nfunction safeValue(value, defaultValue = 'N√£o fornecido') {\n    if (value === null || value === undefined || value === '' || value === 'undefined') {\n        return defaultValue;\n    }\n    return String(value);\n}\n\n// Process transcript\nconst transcript = extractDataNode.transcript || [];\nlet transcriptHTML = '';\n\ntranscript.forEach((turn) => {\n    const role = turn.role === 'agent' ? 'ü§ñ Agente' : 'üë§ Cliente';\n    const time = formatDuration(turn.time_in_call_secs || 0);\n    const message = turn.message || '(sem mensagem)';\n    const bgColor = turn.role === 'agent' ? '#EFF6FF' : '#F0FDF4';\n    const borderColor = turn.role === 'agent' ? '#2563EB' : '#16A34A';\n\n    transcriptHTML += `\n    <div style=\"margin-bottom: 12px; padding: 12px; background: ${bgColor}; border-left: 4px solid ${borderColor}; border-radius: 6px;\">\n      <div style=\"font-weight: 600; color: #1F2937; margin-bottom: 4px;\">\n        ${role} <span style=\"color: #6B7280; font-weight: 400; font-size: 13px;\">(${time})</span>\n      </div>\n      <div style=\"color: #374151; line-height: 1.5;\">${message}</div>\n    </div>\n  `;\n});\n\n// Process collected data (Data Collection)\nconst dataCollection = extractDataNode.data_collection || {};\nlet dataCollectionHTML = '';\n\nObject.keys(dataCollection).forEach(key => {\n    const item = dataCollection[key];\n    const hasValue = item.value !== null && item.value !== undefined && item.value !== '' && item.value !== 'undefined';\n    const icon = hasValue ? '‚úÖ' : '‚ùå';\n    const value = hasValue ? safeValue(item.value) : 'N√£o fornecido';\n    const rationale = (item.rationale && item.rationale !== 'undefined') ? safeValue(item.rationale) : '';\n\n    dataCollectionHTML += `\n    <div style=\"margin-bottom: 10px; padding: 10px; background: #F9FAFB; border-radius: 6px;\">\n      <div style=\"font-weight: 600; color: #1F2937;\">\n        ${icon} ${key.replace(/_/g, ' ').toUpperCase()}\n      </div>\n      <div style=\"color: #374151; margin-top: 4px;\">${value}</div>\n      ${rationale ? `<div style=\"color: #6B7280; font-size: 13px; margin-top: 4px; font-style: italic;\">${rationale}</div>` : ''}\n    </div>\n  `;\n});\n\n// ==========================================\n// MONTHLY STATISTICS LOGIC (UPDATED)\n// ==========================================\n// 1. Determine \"Current Month\" in Brazil Time\nconst now = new Date();\nconst brazilDateString = now.toLocaleString('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    year: 'numeric',\n    month: 'numeric',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: 'numeric'\n});\nconst brazilDate = new Date(brazilDateString);\n\nconst currentMonth = brazilDate.getMonth(); // 0-11 based on Brazil Time\nconst currentYear = brazilDate.getFullYear(); // Year based on Brazil Time\n\nconst monthName = now.toLocaleString('pt-BR', {\n    timeZone: 'America/Sao_Paulo',\n    month: 'long',\n    year: 'numeric'\n});\n\n// Raw API arrays\nconst rawWebConversations = (webStatsData && webStatsData.conversations) ? webStatsData.conversations : [];\nconst rawPhoneConversations = (phoneStatsData && phoneStatsData.conversations) ? phoneStatsData.conversations : [];\n\n// Function to filter conversations only from current month/year (Brazil Time)\nfunction filterCurrentMonth(conversations) {\n    return conversations.filter(conv => {\n        if (!conv.start_time_unix_secs) return false;\n        \n        // Convert conversation timestamp to Brazil Time Date object\n        const convDate = new Date(conv.start_time_unix_secs * 1000);\n        const convBrazilString = convDate.toLocaleString('pt-BR', {\n            timeZone: 'America/Sao_Paulo',\n            year: 'numeric',\n            month: 'numeric',\n            day: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric'\n        });\n        const convBrazilDate = new Date(convBrazilString);\n        \n        return convBrazilDate.getMonth() === currentMonth && convBrazilDate.getFullYear() === currentYear;\n    });\n}\n\n// Apply filters\nconst monthlyWeb = filterCurrentMonth(rawWebConversations);\nconst monthlyPhone = filterCurrentMonth(rawPhoneConversations);\n\n// Calculate Combined Totals\nconst widgetCallsCount = monthlyWeb.length;\nconst phoneCallsCount = monthlyPhone.length;\nconst totalCalls = widgetCallsCount + phoneCallsCount;\n\n// Calculate Total Duration (adding web + phone)\nconst durationWeb = monthlyWeb.reduce((sum, conv) => sum + (conv.call_duration_secs || 0), 0);\nconst durationPhone = monthlyPhone.reduce((sum, conv) => sum + (conv.call_duration_secs || 0), 0);\nconst totalSeconds = durationWeb + durationPhone;\n\nconst totalMinutes = Math.floor(totalSeconds / 60);\nconst avgDuration = totalCalls > 0 ? Math.floor(totalSeconds / totalCalls) : 0;\n\n// ==========================================\n// END OF STATISTICS LOGIC\n// ==========================================\n\n// Monthly summary HTML\nconst monthlyStatsHTML = `\n  <div style=\"background: #F9FAFB; padding: 20px; border-radius: 8px; margin-top: 20px;\">\n    <h3 style=\"color: #1F2937; margin: 0 0 15px 0; font-size: 18px;\">üìä Resumo de ${monthName}</h3>\n    <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;\">\n      <div style=\"background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #2563EB;\">\n        <div style=\"color: #6B7280; font-size: 12px; margin-bottom: 4px;\">TOTAL DE LIGA√á√ïES</div>\n        <div style=\"color: #1F2937; font-size: 20px; font-weight: 600;\">${totalCalls}</div>\n        <div style=\"color: #6B7280; font-size: 11px; margin-top: 4px;\">üìû ${phoneCallsCount} telefone ‚Ä¢ üíª ${widgetCallsCount} widget</div>\n      </div>\n      <div style=\"background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #16A34A;\">\n        <div style=\"color: #6B7280; font-size: 12px; margin-bottom: 4px;\">TOTAL DE MINUTOS</div>\n        <div style=\"color: #1F2937; font-size: 20px; font-weight: 600;\">${totalMinutes}</div>\n        <div style=\"color: #6B7280; font-size: 11px; margin-top: 4px;\">‚è±Ô∏è M√©dia: ${formatMinutes(avgDuration)}</div>\n      </div>\n\n      <div style=\"background: white; padding: 12px; border-radius: 6px; border-left: 3px solid #8B5CF6;\">\n        <div style=\"color: #6B7280; font-size: 12px; margin-bottom: 4px;\">ESTA LIGA√á√ÉO</div>\n        <div style=\"color: #1F2937; font-size: 20px; font-weight: 600;\">#${totalCalls}</div>\n        <div style=\"color: #6B7280; font-size: 11px; margin-top: 4px;\">üìà do m√™s</div>\n      </div>\n    </div>\n  </div>\n`;\n\n// Determine origin and status for the main HTML\nconst isPhone = extractDataNode.phone_call !== null;\nconst origin = isPhone ? 'üìû Liga√ß√£o Telef√¥nica' : 'üíª Widget Web';\nconst statusIcon = extractDataNode.call_successful === 'success' ? '‚úÖ' : '‚ö†Ô∏è';\nconst statusText = extractDataNode.call_successful === 'success' ? 'Sucesso' : 'Problemas';\n\n// Microservice audio URL\nconst audioUrl = audioUploadResponse.url || '#';\nconst audioExpires = audioUploadResponse.expires_in_days || 30;\n\n// Generate complete HTML\nconst html = `<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Relat√≥rio de Intera√ß√£o - ${safeValue(extractDataNode.name)}</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #F3F4F6;\">\n  <div style=\"max-width: 800px; margin: 0 auto; padding: 20px;\">\n    <div style=\"background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%); color: white; padding: 30px; border-radius: 12px 12px 0 0; text-align: center;\">\n      <img src=\"https://i.imgur.com/Rh5FRsy.png\" alt=\"Dentaly\" style=\"width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; border: 4px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.2); object-fit: contain; background: white; padding: 10px;\">\n      <h1 style=\"margin: 0 0 10px 0; font-size: 28px;\">Nova Intera√ß√£o Registrada</h1>\n      <p style=\"margin: 0; opacity: 0.9; font-size: 16px;\">Dentaly - Sa√∫de Bucal Integrada</p>\n    </div>\n    <div style=\"background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n      \n      <div style=\"margin-bottom: 30px;\">\n        <h2 style=\"color: #1F2937; margin: 0 0 20px 0; font-size: 22px; border-bottom: 3px solid #2563EB; padding-bottom: 10px;\">üìä Resumo da Intera√ß√£o</h2>\n        <div style=\"display: grid; gap: 15px;\">\n          <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px; border-left: 4px solid #2563EB;\">\n            <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">NOME DO CLIENTE</div>\n            <div style=\"color: #1F2937; font-size: 18px; font-weight: 600;\">${safeValue(extractDataNode.name)}</div>\n          </div>\n          <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px;\">\n            <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px;\">\n              <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">üìû TELEFONE</div>\n              <div style=\"color: #1F2937; font-weight: 600;\">${safeValue(extractDataNode.phone_number)}</div>\n            </div>\n            <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px;\">\n              <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">üìß E-MAIL</div>\n              <div style=\"color: #1F2937; font-weight: 600;\">${safeValue(extractDataNode.email)}</div>\n            </div>\n          </div>\n          <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px;\">\n            <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px;\">\n              <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">‚è±Ô∏è DURA√á√ÉO</div>\n              <div style=\"color: #1F2937; font-weight: 600;\">${extractDataNode.call_duration || 0}s</div>\n            </div>\n\n            <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px;\">\n              <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">üìç ORIGEM</div>\n              <div style=\"color: #1F2937; font-weight: 600;\">${origin}</div>\n            </div>\n          </div>\n          <div style=\"background: #F9FAFB; padding: 15px; border-radius: 8px;\">\n            <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">üìÖ DATA E HORA (BR)</div>\n            <div style=\"color: #1F2937; font-weight: 600;\">${formatDate(extractDataNode.start_time)}</div>\n          </div>\n          <div style=\"background: ${extractDataNode.call_successful === 'success' ? '#F0FDF4' : '#FEF2F2'}; padding: 15px; border-radius: 8px; border-left: 4px solid ${extractDataNode.call_successful === 'success' ? '#16A34A' : '#DC2626'};\">\n            <div style=\"color: #6B7280; font-size: 13px; margin-bottom: 4px;\">STATUS</div>\n            <div style=\"color: #1F2937; font-weight: 600;\">${statusIcon} ${statusText}</div>\n            <div style=\"color: #6B7280; font-size: 13px; margin-top: 4px;\">${safeValue(extractDataNode.termination_reason, 'N/A')}</div>\n          </div>\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 30px;\">\n        <h2 style=\"color: #1F2937; margin: 0 0 15px 0; font-size: 22px; border-bottom: 3px solid #2563EB; padding-bottom: 10px;\">üìù ${safeValue(extractDataNode.title, 'Resumo')}</h2>\n        <div style=\"background: #EFF6FF; padding: 20px; border-radius: 8px; border-left: 4px solid #2563EB;\">\n          <p style=\"color: #374151; line-height: 1.6; margin: 0;\">${safeValue(extractDataNode.summary, 'Sem resumo dispon√≠vel')}</p>\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 30px;\">\n        <h2 style=\"color: #1F2937; margin: 0 0 15px 0; font-size: 22px; border-bottom: 3px solid #2563EB; padding-bottom: 10px;\">üéß √Åudio da Liga√ß√£o</h2>\n        <div style=\"background: #F9FAFB; padding: 20px; border-radius: 8px; text-align: center;\">\n          <audio controls style=\"width: 100%; max-width: 500px; margin-bottom: 15px;\">\n            <source src=\"${audioUrl}\" type=\"audio/mpeg\">\n            Seu navegador n√£o suporta o elemento de √°udio.\n          </audio>\n          <div style=\"margin-top: 15px;\">\n            <a href=\"${audioUrl}\" download style=\"display: inline-block; background: #2563EB; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600; margin-right: 10px;\">\n              üì• Baixar √Åudio\n            </a>\n            <a href=\"${audioUrl}\" target=\"_blank\" style=\"display: inline-block; background: #6B7280; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600;\">\n              üîó Abrir em Nova Aba\n            </a>\n          </div>\n          <p style=\"color: #6B7280; font-size: 13px; margin: 15px 0 0 0;\">‚è∞ Dispon√≠vel por ${audioExpires} dias</p>\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 30px;\">\n        <h2 style=\"color: #1F2937; margin: 0 0 15px 0; font-size: 22px; border-bottom: 3px solid #2563EB; padding-bottom: 10px;\">üí¨ Transcri√ß√£o Completa</h2>\n        <div style=\"background: #F9FAFB; padding: 20px; border-radius: 8px;\">\n          ${transcriptHTML || '<p style=\"color: #6B7280; text-align: center;\">Nenhuma transcri√ß√£o dispon√≠vel</p>'}\n        </div>\n      </div>\n      \n      <div style=\"margin-bottom: 30px;\">\n        <h2 style=\"color: #1F2937; margin: 0 0 15px 0; font-size: 22px; border-bottom: 3px solid #2563EB; padding-bottom: 10px;\">üìä Dados Coletados</h2>\n        ${dataCollectionHTML || '<p style=\"color: #6B7280; text-align: center;\">Nenhum dado coletado</p>'}\n      </div>\n      \n      <div style=\"margin-top: 40px; padding-top: 20px; border-top: 2px solid #E5E7EB;\">\n        ${monthlyStatsHTML}\n        <div style=\"text-align: center; margin-top: 20px;\">\n          <p style=\"color: #6B7280; font-size: 13px; margin: 0 0 10px 0;\">ID da Conversa: <code style=\"background: #F3F4F6; padding: 2px 6px; border-radius: 4px;\">${safeValue(extractDataNode.conversation_id, 'N/A')}</code></p>\n          <p style=\"color: #9CA3AF; font-size: 12px; margin: 0;\">Sistema de Relat√≥rios Automatizado - Dentaly</p>\n        </div>\n      </div>\n      \n    </div>\n  </div>\n</body>\n</html>`;\n\nreturn {\n    json: {\n        html: html,\n        conversation_id: extractDataNode.conversation_id,\n        name: safeValue(extractDataNode.name),\n        subject: `Nova Intera√ß√£o - ${safeValue(extractDataNode.name)} - ${formatDate(extractDataNode.start_time)}`,\n        audio_url: audioUrl,\n        monthly_stats: {\n            total_calls: totalCalls,\n            total_minutes: totalMinutes,\n            phone_calls: phoneCallsCount,\n            widget_calls: widgetCallsCount\n        }\n    }\n};"},"id":"6efd0b02-0242-48a6-bb15-11dbca844b0f","name":"Gerar HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,16]},{"parameters":{"method":"POST","url":"=https://n8n-upload-audio.gtzkxz.easypanel.host/upload/audio","sendBody":true,"bodyParameters":{"parameters":[{"name":"audio_url","value":"=https://api.elevenlabs.io/v1/convai/conversations/{{ $json.conversation_id }}/audio"},{"name":"api_key","value":"[REDACTED]"},{"name":"conversation_id","value":"={{ $json.conversation_id }}"}]},"options":{}},"id":"2cec9f27-24dc-4585-b784-1899417a246f","name":"Upload upload/audio","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-768,16]},{"parameters":{"url":"=https://api.elevenlabs.io/v1/convai/conversations?Agente_id=Agente_9801k30bf7mge0hbxympamdr1bc0&page_size=100","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"id":"ccdaface-2aa5-4d53-b11c-8ad66574305b","name":"Buscar Estat√°sticas do M√™s web","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-560,16],"credentials":{"httpHeaderAuth":{"id":"aJncYJxPcd9HqT2c","name":"Header Auth account"}}},{"parameters":{"fromEmail":"Sunny <sunny@luzestrategica.com.br>","toEmail":"diegovilson.1999@gmail.com","subject":"={{ $('Gerar HTML').first().json.subject }}","html":"={{ $('Gerar HTML').first().json.html }}","options":{"appendAttribution":false}},"id":"2b787557-1276-4a3a-92d5-7ddcf5c5c40c","name":"Enviar Email2","type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[96,0],"webhookId":"90e3cadb-ef26-408e-bdcb-995f50040c7a","credentials":{"smtp":{"id":"ogzJewLaZMn0xj3c","name":"SMTP noreply@superbot.digital"}}},{"parameters":{"url":"=https://api.elevenlabs.io/v1/convai/conversations?Agente_id=Agente_7301k1ccpdvjevmb008rkgrkv21j&page_size=100","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"id":"4bb67044-7928-4bf0-8abb-5f52d5b1d390","name":"Buscar Estat√°sticas do M√™s TELEFONE","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-352,16],"credentials":{"httpHeaderAuth":{"id":"aJncYJxPcd9HqT2c","name":"Header Auth account"}}}],"connections":{"Extrair Dados":{"main":[[{"node":"Upload upload/audio","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Extrair Dados","type":"main","index":0}]]},"Upload upload/audio":{"main":[[{"node":"Buscar Estat√°sticas do M√™s web","type":"main","index":0}]]},"Buscar Estat√°sticas do M√™s web":{"main":[[{"node":"Buscar Estat√°sticas do M√™s TELEFONE","type":"main","index":0}]]},"Gerar HTML":{"main":[[{"node":"Enviar Email2","type":"main","index":0}]]},"Buscar Estat√°sticas do M√™s TELEFONE":{"main":[[{"node":"Gerar HTML","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n-n8n-start.gtzkxz.easypanel.host","user-Agente":"ElevenLabs/1.0","content-length":"7027","accept":"*/*","accept-encoding":"gzip, deflate, br","content-type":"application/json","elevenlabs-signature":"t=1763951733,v0=[REDACTED]","x-forwarded-for":"34.59.11.47","x-forwarded-host":"n8n-n8n-start.gtzkxz.easypanel.host","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"6ded5c78ff82","x-real-ip":"34.59.11.47"},"params":{},"query":{},"body":{"type":"post_call_transcription","event_timestamp":1763951733,"data":{"Agente_id":"Agente_9801k30bf7mge0hbxympamdr1bc0","conversation_id":"conv_4801kasvdrt2ft59xc2bf9hp2d3a","STATUS":"done","user_id":"rIal6dHgCxf7KnSM1NYvgYcQdD93","branch_id":null,"transcript":[{"role":"Agente","Agente_metadata":{"Agente_id":"Agente_9801k30bf7mge0hbxympamdr1bc0","branch_id":null,"workflow_node_id":null},"message":"Hi! This is Sunny from Dentaly - Sa√∫de Bucal Integrada. ESTA LIGA√á√ÉO may be recorded for quality purposes. Are you ready to get started?","multivoice_message":null,"tool_calls":[],"tool_results":[],"feedback":null,"llm_override":null,"time_in_call_secs":0,"conversation_turn_metrics":null,"rag_retrieval_info":null,"llm_usage":null,"interrupted":false,"original_message":null,"ORIGEM_medium":null}],"metadata":{"start_time_unix_secs":1763951701,"accepted_time_unix_secs":1763951701,"call_DURA√á√ÉO_secs":27,"cost":5,"deletion_settings":{"deletion_time_unix_secs":null,"deleted_logs_at_time_unix_secs":null,"deleted_audio_at_time_unix_secs":null,"deleted_transcript_at_time_unix_secs":null,"delete_transcript_and_pii":false,"delete_audio":false},"feedback":{"type":null,"overall_score":null,"likes":0,"dislikes":0,"rating":null,"comment":null},"authorization_method":"public","charging":{"dev_discount":false,"is_burst":false,"tier":"pro","llm_usage":{"irreversible_generation":{"model_usage":{}},"initiated_generation":{"model_usage":{}}},"llm_price":0,"llm_charge":0,"call_charge":5,"free_minutes_consumed":0,"free_llm_dollars_consumed":0},"TELEFONE_call":null,"batch_call":null,"termination_reason":"Client disconnected: 1000","error":null,"warnings":[],"main_language":"en","rag_usage":null,"text_only":true,"features_usage":{"language_detection":{"enabled":true,"used":false},"transfer_to_Agente":{"enabled":false,"used":false},"transfer_to_number":{"enabled":false,"used":false},"multivoice":{"enabled":false,"used":false},"dtmf_tones":{"enabled":false,"used":false},"external_mcp_servers":{"enabled":false,"used":false},"pii_zrm_workspace":false,"pii_zrm_Agente":false,"tool_dynamic_variable_updates":{"enabled":false,"used":false},"is_livekit":true,"voicE-MAIL_detection":{"enabled":false,"used":false},"workflow":{"enabled":false,"tool_node":{"enabled":false,"used":false},"standalone_Agente_node":{"enabled":false,"used":false},"TELEFONE_number_node":{"enabled":false,"used":false},"end_node":{"enabled":false,"used":false}},"Agente_testing":{"enabled":false,"tests_ran_after_last_modification":false,"tests_ran_in_last_7_dias":false}},"eleven_assistant":{"is_eleven_assistant":false},"initiator_id":null,"conversation_initiation_ORIGEM":"react_sdk","conversation_initiation_ORIGEM_version":"0.5.0","timezone":"America/Los_Angeles","initiation_trigger":{"trigger_type":"default"},"async_metadata":null,"whatsapp":null,"Agente_created_from":"unknown","Agente_last_updated_from":"ui"},"analysis":{"evaluation_criteria_results":{},"data_collection_results":{"TELEFONE_number":{"data_collection_id":"TELEFONE_number","value":null,"json_schema":{"type":"string","description":"TELEFONE number provided by the client.","enum":null,"is_system_provided":false,"dynamic_variable":"","constant_value":""},"rationale":"There is no TELEFONE number provided by the client in the conversation."},"E-MAIL":{"data_collection_id":"E-MAIL","value":null,"json_schema":{"type":"string","description":"The Cliente√¢‚Ç¨‚Ñ¢s E-MAIL address should be in standard E-MAIL format (e.g., [example@E-MAIL.com](mailto:example@E-MAIL.com)) and must not include special characters such as accents.","enum":null,"is_system_provided":false,"dynamic_variable":"","constant_value":""},"rationale":"I cannot extract the Cliente's E-MAIL address from the provided conversation, as it is not mentioned in the transcript."},"reservation_id":{"data_collection_id":"reservation_id","value":null,"json_schema":{"type":"integer","description":"It will be collected through the return of the tools: search_booking_TELEFONE or search_purchase_id","enum":null,"is_system_provided":false,"dynamic_variable":"","constant_value":""},"rationale":"There is no data that matches the schema definition in the provided conversation. The schema requires an integer value that is returned by the tools: search_booking_TELEFONE or search_purchase_id, but neither of these tools are called in the conversation."},"purchase_id":{"data_collection_id":"purchase_id","value":null,"json_schema":{"type":"integer","description":"Always capture the Purchase Code exactly as provided by the user.\nIt MUST be exactly 7 digits (no more, no less).\nNEVER overwrite this value with numbers coming from any tool outputs or system text.\nIf you don√¢‚Ç¨‚Ñ¢t have exactly 7 digits, ask the caller to repeat it slowly, one digit at a time, until you capture 7 digits.\nOnce captured and confirmed, DO NOT modify unless the caller says it√¢‚Ç¨‚Ñ¢s wrong or gives a new code.","enum":null,"is_system_provided":false,"dynamic_variable":"","constant_value":""},"rationale":"I cannot extract the Purchase Code because the user did not provide it in the conversation."},"name":{"data_collection_id":"name","value":null,"json_schema":{"type":"string","description":"The Cliente√¢‚Ç¨‚Ñ¢s name on the other end of the line.","enum":null,"is_system_provided":false,"dynamic_variable":"","constant_value":""},"rationale":"I cannot extract the Cliente's name from the provided conversation. The Agente identifies themself as Sunny from Dentaly - Sa√∫de Bucal Integrada, but there is no mention of the Cliente's name."}},"call_Sucessoful":"Sucesso","transcript_Resumo":"The AI Agente, Sunny from Dentaly - Sa√∫de Bucal Integrada, initiates a conversation, mentioning the call may be recorded. It asks if the user is ready to begin.\n","call_Resumo_title":"Dentaly - Sa√∫de Bucal Integrada call"},"conversation_initiation_client_data":{"conversation_config_override":{"turn":null,"tts":{"voice_id":null,"stability":null,"speed":null,"similarity_boost":null},"conversation":{"text_only":true},"Agente":{"first_message":null,"language":"en","prompt":null}},"custom_llm_extra_body":{},"user_id":"rIal6dHgCxf7KnSM1NYvgYcQdD93","ORIGEM_info":{"ORIGEM":"react_sdk","version":"0.5.0"},"dynamic_variables":{"contact":"emilio@superbot.digital","topic":"Reservas","name":"Emilio","system__Agente_id":"Agente_9801k30bf7mge0hbxympamdr1bc0","system__current_Agente_id":"Agente_9801k30bf7mge0hbxympamdr1bc0","system__conversation_id":"conv_4801kasvdrt2ft59xc2bf9hp2d3a","system__caller_id":null,"system__called_number":null,"system__call_DURA√á√ÉO_secs":26,"system__time_utc":"2025-11-24T02:35:28.619610+00:00","system__time":"Sunday, 18:35 23 November 2025","system__timezone":"America/Los_Angeles","system__call_sid":null}}}},"webhookUrl":"https://n8n-n8n-start.gtzkxz.easypanel.host/webhook/bc26c6f0-d7d0-4734-a9ff-463b76867a9b","executionMode":"production"}}]},"versionId":"be9b57e0-a8f5-4978-8766-6456edc730e5","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-02T17:57:19.537Z","createdAt":"2025-12-02T17:57:19.537Z","role":"workflow:owner","workflowId":"6r96toM7R8JXf51A","projectId":"zyT6Lzq0Jawtq8wZ"}],"activeVersion":null,"tags":[{"updatedAt":"2026-01-02T17:21:30.678Z","createdAt":"2026-01-02T17:21:30.678Z","id":"ZnlUtd5Un2HQcpz6","name":"dentaly"}]}